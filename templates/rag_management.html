{% extends "base.html" %}

{% block title %}Manage Documents - {{ chat_room_id }}{% endblock %}

{% block content %}
<div class="header-section">
    <div class="breadcrumb">
        <a href="/rag">Rooms (채팅방 목록)</a> &gt; <span>{{ chat_room_id }}</span>
    </div>
    <h1>Manage Documents (문서 관리)</h1>
    <p>Upload files to enhance the AI's knowledge for this chat room. (이 채팅방의 AI 지식을 확장하기 위해 파일을 업로드하세요.)</p>
</div>


<div class="card">
    <h2>Room Participants (참여자 목록)</h2>
    <div class="table-responsive">
        {% if participants %}
        <table class="table">
            <thead>
                <tr>
                    <th>Telegram ID</th>
                    <th>Name</th>
                    <th>Username</th>
                </tr>
            </thead>
            <tbody>
                {% for p in participants %}
                <tr>
                    <td>{{ p.telegram_id }}</td>
                    <td>{{ p.first_name }} {{ p.last_name or "" }}</td>
                    <td>{{ "@" + p.username if p.username else "-" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="text-muted">No participants found. (참여자가 없습니다.)</p>
        {% endif %}
    </div>
</div>

<div class="card">
    <h2>Upload New File (새 파일 업로드)</h2>
    <form action="/rag/{{ chat_room_id }}/upload" method="post" enctype="multipart/form-data" class="form-group">
        <div class="input-group">
            <label for="file">Choose File (파일 선택):</label>
            <input type="file" id="file" name="file" required accept=".pdf,.txt,.md">
        </div>
        <button type="submit" class="btn btn-primary">Upload (업로드)</button>
    </form>
</div>

<div class="card">
    <h2>Existing Documents (기존 문서 목록)</h2>
    <div class="table-responsive">
        {% if docs %}
        <table class="table">
            <thead>
                <tr>
                    <th>Filename (파일명)</th>
                    <th>Type (유형)</th>
                    <th>Size (크기)</th>
                    <th>Date (날짜)</th>
                    <th>Actions (작업)</th>
                </tr>
            </thead>
            <tbody>
                {% for doc in docs %}
                <tr>
                    <td>{{ doc.filename }}</td>
                    <td><span class="badge">{{ doc.file_type }}</span></td>
                    <td>{{ (doc.size / 1024)|round(1) }} KB</td>
                    <td>{{ doc.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>
                        <form action="/rag/{{ chat_room_id }}/delete/{{ doc.id }}" method="post" onsubmit="return confirm('Are you sure you want to delete this file? (이 파일을 정말 삭제하시겠습니까?)');">
                            <button type="submit" class="btn btn-danger btn-sm">Delete (삭제)</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="text-muted">No documents uploaded yet. (업로드된 문서가 없습니다.)</p>
        {% endif %}
    </div>
</div>

<style>
    .breadcrumb {
        margin-bottom: 1rem;
        color: var(--text-muted);
    }
    .breadcrumb a {
        color: var(--primary-color);
        text-decoration: none;
    }
    .badge {
        background: var(--bg-secondary);
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
        font-size: 0.85em;
    }
    .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.85em;
    }
    .table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
    }
    .table th, .table td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
    }
    .table th {
        font-weight: 600;
        color: var(--text-muted);
    }
</style>
{% endblock %}
