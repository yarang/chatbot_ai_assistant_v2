---
globs: core/logger.py,core/middleware.py,core/exceptions.py
description: ë¡œê¹… ë° ì˜ˆì™¸ ì²˜ë¦¬ ê°€ì´ë“œ
---

# ğŸš¨ ë¡œê¹… ë° ì˜ˆì™¸ ì²˜ë¦¬ ê°€ì´ë“œ

## ë¡œê¹… êµ¬ì¡°

### Logger ì„¤ì • (`core/logger.py`)

```python
import logging
from logging.handlers import RotatingFileHandler
import os

LOG_DIR = "logs"
os.makedirs(LOG_DIR, exist_ok=True)

logger = logging.getLogger("app_logger")
logger.setLevel(logging.INFO)

file_handler = RotatingFileHandler(f"{LOG_DIR}/app.log", maxBytes=2*1024*1024, backupCount=3)
formatter = logging.Formatter("[%(asctime)s] [%(levelname)s] %(message)s")
file_handler.setFormatter(formatter)

logger.addHandler(file_handler)
```

### Middleware ë¡œê¹… (`core/middleware.py`)

```python
from fastapi import Request
from starlette.middleware.base import BaseHTTPMiddleware
from core.logger import logger
import time

class LoggingMiddleware(BaseHTTPMiddleware):
    async def dispatch(self, request: Request, call_next):
        start_time = time.time()
        try:
            response = await call_next(request)
            process_time = time.time() - start_time
            logger.info(
                f"{request.method} {request.url.path} "
                f"status={response.status_code} time={process_time:.2f}s"
            )
            return response
        except Exception as e:
            logger.error(f"Unhandled error: {e}")
            raise
```

## ì˜ˆì™¸ ì²˜ë¦¬ êµ¬ì¡°

### Custom Exception (`core/exceptions.py`)

```python
from fastapi import Request
from fastapi.responses import JSONResponse
from core.logger import logger

class AppException(Exception):
    def __init__(self, message: str, status_code: int = 400):
        self.message = message
        self.status_code = status_code

async def app_exception_handler(request: Request, exc: AppException):
    logger.warning(f"AppException: {exc.message}")
    return JSONResponse(
        status_code=exc.status_code,
        content={"error": exc.message}
    )

async def generic_exception_handler(request: Request, exc: Exception):
    logger.error(f"Unhandled Exception: {exc}")
    return JSONResponse(
        status_code=500,
        content={"error": "Internal Server Error"}
    )
```

## ë¡œê¹… ë° ì˜ˆì™¸ ì²˜ë¦¬ ì›ì¹™

### ë¡œê¹… ë ˆë²¨

- **INFO**: ì¼ë°˜ì ì¸ ìš”ì²­/ì‘ë‹µ ë¡œê¹…
- **WARNING**: ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ (AppException)
- **ERROR**: ì‹œìŠ¤í…œ ì˜ˆì™¸ ë° ì²˜ë¦¬ ë¶ˆê°€ëŠ¥í•œ ì˜¤ë¥˜
- **DEBUG**: ê°œë°œ ì‹œ ë””ë²„ê¹… ì •ë³´

### ë¡œê·¸ í¬ë§·

- **ì‹œê°„**: `[%(asctime)s]`
- **ë ˆë²¨**: `[%(levelname)s]`
- **ë©”ì‹œì§€**: `%(message)s`
- **êµ¬ì¡°**: `[ì‹œê°„] [ë ˆë²¨] ë©”ì‹œì§€`

### ì˜ˆì™¸ ì²˜ë¦¬ ê³„ì¸µ

- **AppException**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì˜ˆì™¸ (400ë²ˆëŒ€)
- **ValidationError**: ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨ (422)
- **Generic Exception**: ì‹œìŠ¤í…œ ì˜ˆì™¸ (500)

### ë¡œê·¸ íŒŒì¼ ê´€ë¦¬

- **RotatingFileHandler**: íŒŒì¼ í¬ê¸° ì œí•œ (2MB)
- **ë°±ì—… íŒŒì¼**: ìµœëŒ€ 3ê°œ ë°±ì—… íŒŒì¼ ìœ ì§€
- **ë¡œê·¸ ë””ë ‰í† ë¦¬**: `logs/app.log`

### ë¡œê¹… ëª¨ë²” ì‚¬ë¡€

- **ìš”ì²­ ë¡œê¹…**: ëª¨ë“  HTTP ìš”ì²­ì˜ method, path, ì²˜ë¦¬ì‹œê°„ ê¸°ë¡
- **ì—ëŸ¬ ë¡œê¹…**: ì˜ˆì™¸ ë°œìƒ ì‹œ ìƒì„¸ ì •ë³´ ê¸°ë¡
- **ì„±ëŠ¥ ë¡œê¹…**: ì²˜ë¦¬ ì‹œê°„ ì¸¡ì • ë° ê¸°ë¡
- **ë³´ì•ˆ**: ë¯¼ê°í•œ ì •ë³´ëŠ” ë¡œê¹…í•˜ì§€ ì•ŠìŒ